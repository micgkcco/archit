<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive SFT Reporting Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --font-family-apple: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            --background-body: #f5f5f7;
            --background-light: #ffffff;
            --text-primary: #1d1d1f;
            --text-secondary: #515154;
            --text-tertiary: #86868b;
            --link-blue: #007aff;
            --link-blue-rgb: 0, 122, 255; /* For rgba usage */
            --link-blue-hover: #0071e3;
            --border-color-light: #d2d2d7;
            --warning-red: #ff3b30; /* Apple red for warnings */
            --warning-red-rgb: 255, 59, 48;
        }

        body {
            font-family: var(--font-family-apple);
            background-color: var(--background-body);
            color: var(--text-secondary);
        }
        h1, h2, h3, h4, h5, h6 { /* Apply to all heading levels */
            font-family: var(--font-family-apple);
            color: var(--text-primary);
            font-weight: 600; /* Consistent heading weight */
        }

        /* Page Title Header */
        .page-title-header {
            background-color: var(--background-body); 
            padding: 1.5rem 0; 
            text-align: center;
            border-bottom: 0.5px solid var(--border-color-light);
        }
        .page-title-header .page-main-title-link { 
            text-decoration: none;
            color: inherit; 
        }
        .page-title-header .page-main-title-link:hover h1 { 
             color: var(--link-blue);
        }
        .page-title-header h1 {
            font-size: 2rem; 
            font-weight: 700;
            transition: color 0.2s ease-in-out; 
        }
        .page-title-header p {
            font-size: 1rem; 
            color: var(--text-secondary);
        }


        /* Sticky Navigation Bar */
        #mainNav {
            position: sticky;
            top: 0;
            background-color: rgba(255, 255, 255, 0.85); 
            backdrop-filter: saturate(180%) blur(15px);
            -webkit-backdrop-filter: saturate(180%) blur(15px);
            z-index: 50;
            box-shadow: none;
            border-bottom: 0.5px solid var(--border-color-light);
        }
        .nav-link {
            color: var(--text-secondary);
            border-bottom-width: 2px;
            border-bottom-color: transparent;
            transition: color 0.3s ease, border-bottom-color 0.3s ease, font-weight 0.3s ease;
            font-size: 0.9rem; 
            padding: 0.75rem 1rem; 
            font-weight: 400;
        }
        .nav-link:hover {
            color: var(--link-blue);
            border-bottom-color: var(--link-blue);
        }
        .nav-link.active {
            color: var(--link-blue);
            border-bottom-color: var(--link-blue);
            font-weight: 600;
        }
        
        .content-section { display: none; }
        .content-section.active { display: block; }

        .card {
            background-color: var(--background-light);
            border-radius: 14px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.04), 0 5px 15px rgba(0,0,0,0.06); 
            padding: 24px; 
            margin-bottom: 1.5rem;
        }
        .card h2, .card h3, .card h4 { 
             margin-bottom: 0.75rem;
        }
        .card p, .card ul li {
            font-size: 1rem; 
            line-height: 1.65;
            color: var(--text-secondary);
        }
        .card ul {
            padding-left: 1.25rem;
            margin-top: 0.5rem;
        }

        /* Accordion Styles */
        .accordion-item { 
        }
        .accordion-header {
            background-color: rgba(var(--text-primary-rgb, 29, 29, 31), 0.04); 
            color: var(--text-primary);
            padding: 0.75rem 1rem;
            border-radius: 8px; 
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            border: 1px solid var(--border-color-light);
        }
        .accordion-header:hover {
            background-color: rgba(var(--text-primary-rgb, 29, 29, 31), 0.07);
        }
        .accordion-header .arrow-icon {
            transform: rotate(0deg);
            transition: transform 0.3s ease-out;
        }
        .accordion-header.open .arrow-icon { 
             transform: rotate(180deg);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.35s ease-out;
            padding: 0 1rem; 
            border: 1px solid var(--border-color-light);
            border-top: none;
            border-radius: 0 0 8px 8px;
        }
        .accordion-header.open + .accordion-content {
            padding: 1rem; 
        }


        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            background-color: var(--background-light);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 4px 8px rgba(0,0,0,0.05);
        }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        
        .filter-input, .filter-select {
            border: 1px solid var(--border-color-light);
            background-color: var(--background-light);
            color: var(--text-primary);
            border-radius: 6px;
            padding: 0.65rem 0.75rem; 
            font-size: 0.9rem;
            width: 100%;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .filter-input:focus, .filter-select:focus {
            border-color: var(--link-blue);
            box-shadow: 0 0 0 2px rgba(var(--link-blue-rgb), 0.2);
            outline: none;
        }
        label {
            font-size: 0.875rem;
            color: var(--text-primary);
            font-weight: 500;
            margin-bottom: 0.25rem;
            display: block;
        }

        /* Step Diagram */
        .step-item { display: flex; align-items: center; margin-bottom: 0.75rem; }
        .step-number {
            background-color: var(--link-blue);
            color: white;
            border-radius: 50%;
            width: 2.25rem; height: 2.25rem;
            display: flex; justify-content: center; align-items: center;
            font-weight: 600; font-size: 0.9rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }
        .step-text { 
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Icon Placeholders */
        .icon-placeholder { 
            display: inline-flex; 
            align-items: center;
            justify-content: center;
            width: 1.1em; height: 1.1em;
            background-color: rgba(var(--link-blue-rgb), 0.12); 
            border-radius: 0.25rem;
            color: var(--link-blue); 
            font-weight: 500; 
            margin-right: 0.35rem;
            font-size: 0.9em; 
            line-height: 1.1em;
        }

        /* Info/Warning/Note Boxes */
        .info-box {
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            border-width: 1px;
            border-style: solid;
            font-size: 0.9rem;
        }
        .info-box-note { 
            background-color: rgba(var(--text-secondary-rgb, 81, 81, 84), 0.05);
            border-color: rgba(var(--text-secondary-rgb, 81, 81, 84), 0.2);
            color: var(--text-secondary);
        }
        .info-box-info { 
            background-color: rgba(var(--link-blue-rgb), 0.07);
            border-color: rgba(var(--link-blue-rgb), 0.3);
            color: var(--link-blue); 
        }
        .info-box-info strong { color: var(--link-blue); }

        .info-box-warning { 
            background-color: rgba(var(--warning-red-rgb), 0.07);
            border-color: rgba(var(--warning-red-rgb), 0.4);
            color: var(--warning-red);
        }
        .info-box-warning h4, .info-box-warning strong { color: var(--warning-red); }


        /* Footer */
        footer {
            text-align: center;
            padding: 2rem 1rem;
            margin-top: 2rem;
            border-top: 0.5px solid var(--border-color-light);
            background-color: var(--background-body);
        }
        footer p {
            font-size: 0.8rem; 
            color: var(--text-tertiary);
        }
    </style>
</head>
<body class="antialiased">

    <header class="page-title-header">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <a href="index.html" class="page-main-title-link">
                <h1 class="text-3xl font-bold">Interactive Guide to SFT Reporting</h1>
            </a>
            <p class="text-md mt-1">Understanding Section 285BA of the Income Tax Act, 1961</p>
        </div>
    </header>

    <nav id="mainNav" class="sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-wrap justify-center items-center py-1">
                <a href="#overview" class="nav-link text-sm sm:text-base p-3 md:p-4">Overview</a>
                <a href="#principles" class="nav-link text-sm sm:text-base p-3 md:p-4">Key Principles</a>
                <a href="#transactions" class="nav-link text-sm sm:text-base p-3 md:p-4">Reportable Transactions</a>
                <a href="#bonus-shares" class="nav-link text-sm sm:text-base p-3 md:p-4">Bonus Shares</a>
                <a href="#filing" class="nav-link text-sm sm:text-base p-3 md:p-4">Filing & Compliance</a>
                <a href="#penalties" class="nav-link text-sm sm:text-base p-3 md:p-4">Penalties</a>
                <a href="#takeaways" class="nav-link text-sm sm:text-base p-3 md:p-4">Takeaways</a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <section id="overview" class="content-section">
            <h2 class="text-2xl font-semibold mb-4">1. Overview of SFT</h2>
            <div class="card">
                <p class="mb-3">The Statement of Specified Financial Transactions (SFTs) is a critical mechanism in India's tax system, established under Section 285BA of the Income Tax Act, 1961. It mandates specified entities to report high-value financial transactions to the Income Tax Department (ITD).</p>
                <h4 class="font-semibold mb-2 text-lg">Key Objectives:</h4>
                <ul class="list-disc list-inside space-y-1">
                    <li><span class="icon-placeholder">üéØ</span>Monitor high-value transactions by taxpayers.</li>
                    <li><span class="icon-placeholder">üí∞</span>Curb the issue of black money.</li>
                    <li><span class="icon-placeholder">üìà</span>Widen the national tax base.</li>
                    <li><span class="icon-placeholder">üõ°Ô∏è</span>Improve integrity and transparency of the Indian financial ecosystem.</li>
                </ul>
                <p class="mt-3">SFT data is used for intelligence gathering, risk profiling, and targeted enforcement. Information filed in Form 61A is reflected in the taxpayer's Annual Information Statement (AIS) and Form 26AS, aiding in accurate ITR filing.</p>
            </div>
        </section>

        <section id="principles" class="content-section">
            <h2 class="text-2xl font-semibold mb-4">2. Core Principles of SFT Reporting</h2>
            <div class="accordion-item mb-4">
                <button class="accordion-header w-full text-left font-semibold flex justify-between items-center">
                    <span>Broad Definition of "Specified Financial Transaction"</span>
                    <span class="arrow-icon transform transition-transform duration-300">‚ñº</span>
                </button>
                <div class="accordion-content">
                    <p>Section 285BA broadly covers transactions like purchase/sale of goods, property, rights; rendering services; works contracts; investments; expenditures; and loans/deposits. This wide scope allows ITD to capture diverse financial movements.</p>
                </div>
            </div>
            <div class="accordion-item mb-4">
                <button class="accordion-header w-full text-left font-semibold flex justify-between items-center">
                    <span>Aggregation Rules for Monetary Thresholds</span>
                    <span class="arrow-icon transform transition-transform duration-300">‚ñº</span>
                </button>
                <div class="accordion-content">
                    <p class="mb-2">For most SFTs (exceptions: immovable property, cash receipts for sales), amounts must be aggregated to check if thresholds are met. This prevents splitting transactions to avoid reporting.</p>
                    <ul class="list-disc list-inside space-y-1">
                        <li>All accounts of the same nature for a person in a FY are aggregated (e.g., multiple savings accounts in one bank).</li>
                        <li>All transactions of the same nature for a person in a FY are aggregated (e.g., multiple share purchases from one company).</li>
                    </ul>
                </div>
            </div>
            <div class="accordion-item mb-4">
                <button class="accordion-header w-full text-left font-semibold flex justify-between items-center">
                    <span>Joint Accounts/Transactions</span>
                    <span class="arrow-icon transform transition-transform duration-300">‚ñº</span>
                </button>
                <div class="accordion-content">
                    <p>If an account or transaction is in multiple names (e.g., joint account), the <strong style="color: var(--link-blue);">entire value</strong> is attributed to <strong style="color: var(--link-blue);">each person</strong> for threshold checking. This increases scrutiny on jointly held assets and means individuals can be flagged even if their personal share is below the threshold, if the total joint transaction crosses it.</p>
                </div>
            </div>
             <p class="mt-4 info-box info-box-note">
                <span style="font-weight: 600; color: var(--text-primary);">Note:</span> These principles are designed to capture the true economic substance of financial activity and prevent tax evasion through complex structuring.
            </p>
        </section>

        <section id="transactions" class="content-section">
            <h2 class="text-2xl font-semibold mb-4">3. Reportable Transactions Explorer</h2>
            <div class="card">
                <p class="mb-4">Rule 114E of the Income Tax Rules, 1962, details specific reportable transactions. Explore them below. This interactive tool helps you filter and understand the various SFTs, their thresholds, and who is responsible for reporting.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label for="filterKeyword">Filter by Keyword:</label>
                        <input type="text" id="filterKeyword" class="filter-input" placeholder="e.g., Shares, Cash, Property">
                    </div>
                    <div>
                        <label for="filterThreshold">Filter by Threshold (Min Lakhs):</label>
                        <select id="filterThreshold" class="filter-select">
                            <option value="">All Thresholds</option>
                            <option value="1">‚Çπ1 Lakh+</option>
                            <option value="2">‚Çπ2 Lakh+</option>
                            <option value="10">‚Çπ10 Lakh+</option>
                            <option value="30">‚Çπ30 Lakh+</option>
                            <option value="50">‚Çπ50 Lakh+</option>
                        </select>
                    </div>
                    <div>
                        <label for="filterEntity">Filter by Reporting Entity:</label>
                        <select id="filterEntity" class="filter-select">
                            <option value="">All Entities</option>
                        </select>
                    </div>
                </div>
                <div id="transactionList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
                <p id="noResults" class="text-center py-4" style="display: none; color: var(--text-secondary);">No transactions match your filters.</p>

                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-3 text-center">Transaction Threshold Distribution</h3>
                    <div class="chart-container">
                        <canvas id="thresholdChart"></canvas>
                    </div>
                    <p class="text-xs mt-2 text-center" style="color: var(--text-tertiary);">This chart shows the number of SFT categories associated with different monetary threshold levels.</p>
                </div>
            </div>
        </section>

        <section id="bonus-shares" class="content-section">
            <h2 class="text-2xl font-semibold mb-4">4. Bonus Shares & SFT Reporting</h2>
            <div class="card">
                <h3 class="text-xl font-semibold mb-3">Is the issuance of Bonus Shares by a company reportable under SFT by the issuing company?</h3>
                <div class="info-box info-box-info">
                    <p style="font-weight: 600; font-size: 1.1rem;">Generally, NO.</p>
                </div>
                <div class="mt-4 space-y-3">
                    <p><span class="icon-placeholder">‚ÑπÔ∏è</span> Bonus shares are issued without monetary consideration from shareholders. They represent capitalization of company reserves (a capital restructuring).</p>
                    <p><span class="icon-placeholder">üö´</span> SFT Category "Receipt for acquiring shares" (Sl. No. 8 in Rule 114E) implies the company <strong style="color: var(--link-blue);">receives money</strong> for issuing shares. This doesn't happen with bonus shares.</p>
                    <p><span class="icon-placeholder">üí∏</span> No immediate tax liability for shareholders on receiving bonus shares. Cost of acquisition is usually nil. Tax (capital gains) arises only upon <strong style="color: var(--link-blue);">sale</strong> of bonus shares.</p>
                    <p><span class="icon-placeholder">üîç</span> While the <strong style="color: var(--link-blue);">issuance itself</strong> is not directly reported by the company under SFT, the ITD gains visibility through:
                        <ul class="list-disc list-inside ml-6 mt-1">
                            <li>Capital gains reported by shareholders on sale (pre-filled in ITR).</li>
                            <li>Reporting by intermediaries like depositories for "Depository Transactions" (movement/trading of shares).</li>
                        </ul>
                    </p>
                    <p><span class="icon-placeholder">‚úÖ</span> Transactions like IPOs, Rights Issues (where company receives money) or Share Buybacks (company pays money) <strong style="color: var(--text-primary);">are reportable</strong> if thresholds are met.</p>
                </div>
            </div>
        </section>

        <section id="filing" class="content-section">
            <h2 class="text-2xl font-semibold mb-4">5. SFT Filing Procedures & Compliance</h2>
            <div class="card">
                <p class="mb-4">SFT must be filed in Form 61A. The process involves several key steps. Adherence to procedures and timelines is crucial.</p>
                <h3 class="text-lg font-semibold mb-3">Key Steps in SFT Filing:</h3>
                <div class="space-y-3">
                    <div class="step-item"><div class="step-number">1</div><div class="step-text">Register on Income Tax e-filing portal as "Reporting Entity".</div></div>
                    <div class="step-item"><div class="step-number">2</div><div class="step-text">Principal Officer creates login and provides organizational details.</div></div>
                    <div class="step-item"><div class="step-number">3</div><div class="step-text">Obtain unique ITDREIN (Income Tax Department Reporting Entity Identification Number). Mandatory if reportable transactions exist.</div></div>
                    <div class="step-item"><div class="step-number">4</div><div class="step-text">Prepare SFT report in prescribed XML format (as per ITD schema).</div></div>
                    <div class="step-item"><div class="step-number">5</div><div class="step-text">Validate data using ITD utility to correct errors.</div></div>
                    <div class="step-item"><div class="step-number">6</div><div class="step-text">Digitally sign Form 61A with Class 2 or 3 DSC.</div></div>
                    <div class="step-item"><div class="step-number">7</div><div class="step-text">Upload to e-filing portal. Receive acknowledgment.</div></div>
                </div>

                <div class="mt-6 info-box info-box-info">
                    <p><strong style="color: var(--link-blue); font-weight:600;">Due Date:</strong> May 31st of the assessment year following the financial year of the transaction. (e.g., FY 2023-24 transactions reported by May 31, 2025).</p>
                </div>

                <div class="mt-4 accordion-item">
                     <button class="accordion-header w-full text-left font-semibold flex justify-between items-center">
                        <span>Defects & Revisions</span>
                        <span class="arrow-icon transform transition-transform duration-300">‚ñº</span>
                    </button>
                    <div class="accordion-content">
                        <p>If errors are found, a revised statement can be submitted. If ITD notifies a defect, it must be rectified within 30 days. Failure to rectify (post Sep 1, 2019) is treated as inaccurate information.</p>
                    </div>
                </div>

                <div class="mt-4 accordion-item">
                     <button class="accordion-header w-full text-left font-semibold flex justify-between items-center">
                        <span>Nil SFT & Preliminary Response</span>
                        <span class="arrow-icon transform transition-transform duration-300">‚ñº</span>
                    </button>
                    <div class="accordion-content">
                        <p>If no reportable transactions, experts often recommend filing a Nil SFT. Alternatively, use the "SFT Preliminary Response" on the e-Filing portal to indicate non-reportability for the year.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="penalties" class="content-section">
            <h2 class="text-2xl font-semibold mb-4">6. Consequences of Non-Compliance</h2>
            <div class="card">
                <p class="mb-4">Failure to comply with SFT reporting obligations can lead to significant penalties. It's crucial to be timely and accurate.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="info-box info-box-warning">
                        <h4 class="font-semibold text-lg mb-1"><span class="icon-placeholder" style="background-color: rgba(var(--warning-red-rgb),0.15); color: var(--warning-red);">‚ö†Ô∏è</span> Failure to Furnish SFT by Due Date:</h4>
                        <p>‚Çπ500 per day of default.</p>
                    </div>
                    <div class="info-box info-box-warning">
                        <h4 class="font-semibold text-lg mb-1"><span class="icon-placeholder" style="background-color: rgba(var(--warning-red-rgb),0.15); color: var(--warning-red);">‚ö†Ô∏è</span> Failure After Notice:</h4>
                        <p>If default continues after ITD notice (30 days to comply), penalty increases to ‚Çπ1,000 per day from expiry of notice period.</p>
                    </div>
                    <div class="info-box info-box-warning">
                        <h4 class="font-semibold text-lg mb-1"><span class="icon-placeholder" style="background-color: rgba(var(--warning-red-rgb),0.15); color: var(--warning-red);">‚ö†Ô∏è</span> Inaccurate Statement:</h4>
                        <p>‚Çπ50,000 penalty. (Includes unrectified defects post Sep 1, 2019).</p>
                    </div>
                    <div class="info-box info-box-warning">
                        <h4 class="font-semibold text-lg mb-1"><span class="icon-placeholder" style="background-color: rgba(var(--warning-red-rgb),0.15); color: var(--warning-red);">‚ö†Ô∏è</span> For Eligible Investment Funds:</h4>
                        <p>Failure to furnish required statements/info can attract ‚Çπ5,00,000 penalty.</p>
                    </div>
                </div>
                <p class="mt-4 text-sm" style="color: var(--text-secondary);">Beyond direct penalties, non-compliance can trigger deeper investigations, audits, and reputational damage.</p>
            </div>
        </section>

        <section id="takeaways" class="content-section">
            <h2 class="text-2xl font-semibold mb-4">7. Key Takeaways & Recommendations</h2>
            <div class="card">
                <p class="mb-3">SFT reporting is a cornerstone of India's tax transparency efforts. Issuance of bonus shares by the company is generally NOT a direct SFT trigger for the issuer. The SFT regime is dynamic, requiring continuous adaptation.</p>
                <h3 class="text-lg font-semibold mt-4 mb-2">Recommendations for Robust Compliance:</h3>
                <ul class="list-disc list-inside space-y-2">
                    <li><span class="icon-placeholder">‚öôÔ∏è</span><strong>Continuous Monitoring & System Integration:</strong> Integrate SFT tracking with ERP systems for proactive identification of reportable transactions.</li>
                    <li><span class="icon-placeholder">üóÇÔ∏è</span><strong>Accurate Data Management:</strong> Maintain meticulous records for all financial transactions, especially share-related activities.</li>
                    <li><span class="icon-placeholder">üóìÔ∏è</span><strong>Timely Filing & Prompt Rectification:</strong> Adhere strictly to the May 31st due date and rectify any ITD-notified defects within 30 days.</li>
                    <li><span class="icon-placeholder">‚úÖ</span><strong>Leverage ITD Functionalities:</strong> Use "SFT Preliminary Response" if no transactions are reportable.</li>
                    <li><span class="icon-placeholder">üîÑ</span><strong>Stay Updated:</strong> Regularly consult CBDT notifications and the ITD Reporting Portal for changes.</li>
                </ul>
                <p class="mt-4 info-box info-box-info" style="background-color: rgba(var(--link-blue-rgb), 0.06); border-color: rgba(var(--link-blue-rgb),0.2); color: var(--text-primary);"> Proactive compliance mitigates risks, enhances reputation, and ensures smooth operations.</p>
            </div>
        </section>
    </main>

    <footer>
        <p>This interactive guide is for informational purposes only and not a substitute for professional tax advice. Based on content from the "Comprehensive Guide to SFT Reporting".</p>
    </footer>

<script>
    const sftData = [
        { sl: 1, nature: "Cash payment for purchase of bank drafts or pay orders or banker‚Äôs cheque", thresholdText: "Aggregating to Rs. 10 lakh or more in a FY", thresholdVal: 10, entity: "Banking company or co-operative bank" },
        { sl: 2, nature: "Cash payments for the purchase of pre-paid instruments issued by RBI", thresholdText: "Aggregating to Rs. 10 lakh or more during FY", thresholdVal: 10, entity: "Banking company or co-operative bank" },
        { sl: 3, nature: "Cash deposits or withdrawals from one or more current accounts", thresholdText: "Aggregating to Rs. 50 lakh or more in an FY", thresholdVal: 50, entity: "Banking company or co-operative bank" },
        { sl: 4, nature: "Cash deposits in one or more accounts other than a current account and time deposit of a person", thresholdText: "Aggregating to Rs. 10 lakh or more in an FY", thresholdVal: 10, entity: "Banking company, co-operative bank, Post-Master General" },
        { sl: 5, nature: "One or more time deposits (other than renewed time deposit of another time deposit) of a person", thresholdText: "Aggregating to Rs. 10 lakh or more in an FY", thresholdVal: 10, entity: "Banking company, co-operative bank, Post-Master General, Nidhi Company, NBFC" },
        { sl: 6, nature: "Credit card payments made by any person either in cash or by any other mode in a FY", thresholdText: "Rs. 1 lakh or more (cash) OR Rs. 10 lakh or more (by any other mode) in an FY", thresholdVal: [1, 10], entity: "Banking company or Co-operative bank to which Banking Regulation applies or any other company or institution issuing credit card" },
        { sl: 7, nature: "Receipt from any person for acquiring bonds or debentures issued by the company or institution (other than renewal)", thresholdText: "Aggregating to Rs. 10 lakh or more in an FY", thresholdVal: 10, entity: "Company or institution issuing bonds or debentures" },
        { sl: 8, nature: "Receipt from any person for acquiring shares (including share application money) issued by the company", thresholdText: "Aggregating to Rs. 10 lakh or more in an FY", thresholdVal: 10, entity: "Company issuing shares" },
        { sl: 9, nature: "Buyback of shares from any person (other than the shares bought in the open market)", thresholdText: "Aggregating to Rs. 10 lakh or more in an FY", thresholdVal: 10, entity: "Listed company purchasing its own securities under Section 68 of the Companies Act, 2013" },
        { sl: 10, nature: "Receipt from any person for acquiring units of one or more schemes of a mutual fund (other than transfer from one scheme to another)", thresholdText: "Aggregating to Rs. 10 lakh or more in an FY", thresholdVal: 10, entity: "A trustee of a mutual fund or any such other person authorised to manage the affairs of the mutual fund" },
        { sl: 11, nature: "Receipt from any person for sale of foreign currency including any credit of such currency to a foreign exchange card or expense in such currency through a debit or credit card or through the issue of travellers cheque or draft or any other instrument", thresholdText: "Aggregating to Rs. 10 lakh or more during an FY", thresholdVal: 10, entity: "Authorised person as referred to in Section 2(c) of the Foreign Exchange Management Act, 1999" },
        { sl: 12, nature: "Purchase or sale of immovable property", thresholdText: "Transaction value or valuation of stamp duty authority referred in Section 50C for an amount of Rs. 30 lakh or more", thresholdVal: 30, entity: "Inspector-General appointed under Section 3 of the Registration Act, 1908 or Registrar or Sub-Registrar appointed under section 6 of that Act" },
        { sl: 13, nature: "Cash receipt for sale, by any person, of goods or services of any nature (other than those specified at Sl. Nos. 1 to 10)", thresholdText: "Exceeding Rs. 2 lakh", thresholdVal: 2, entity: "Any person who is liable for audit under section 44AB of the Act" }
    ];

    const navLinks = document.querySelectorAll('#mainNav a');
    const contentSections = document.querySelectorAll('.content-section');
    const transactionListDiv = document.getElementById('transactionList');
    const filterKeywordInput = document.getElementById('filterKeyword');
    const filterThresholdSelect = document.getElementById('filterThreshold');
    const filterEntitySelect = document.getElementById('filterEntity');
    const noResultsP = document.getElementById('noResults');
    let thresholdChartInstance = null;

    function populateEntityFilter() {
        const entities = new Set();
        sftData.forEach(item => {
            item.entity.split(',').forEach(e => entities.add(e.trim()));
        });
        const sortedEntities = Array.from(entities).sort();
        filterEntitySelect.innerHTML = '<option value="">All Entities</option>'; 
        sortedEntities.forEach(entity => {
            const option = document.createElement('option');
            option.value = entity;
            option.textContent = entity;
            filterEntitySelect.appendChild(option);
        });
    }

    // --- CORRECTED displayTransactions function ---
    function displayTransactions(filteredData) {
        transactionListDiv.innerHTML = ''; // Clear existing cards
        if (filteredData.length === 0) {
            noResultsP.style.display = 'block';
            return;
        }
        noResultsP.style.display = 'none';

        filteredData.forEach(item => {
            const card = document.createElement('div');
            card.className = 'p-4 border rounded-lg shadow-sm hover:shadow-md transition-shadow';
            card.style.backgroundColor = 'var(--background-light)';
            card.style.borderColor = 'var(--border-color-light)';
            card.style.borderRadius = '10px'; // Consistent with other card styles

            // Title (h4)
            const titleH4 = document.createElement('h4');
            titleH4.className = 'font-semibold text-md mb-1'; // Tailwind classes for styling
            titleH4.style.color = 'var(--text-primary)';
            const natureText = item.nature.length > 50 ? item.nature.substring(0, 50) + '...' : item.nature;
            titleH4.textContent = `${item.sl}. ${natureText}`;

            // Threshold (p)
            const thresholdP = document.createElement('p');
            thresholdP.className = 'text-sm mb-1';
            thresholdP.style.color = 'var(--text-secondary)';
            
            const thresholdStrong = document.createElement('strong');
            thresholdStrong.style.color = 'var(--text-primary)';
            thresholdStrong.textContent = 'Threshold: ';
            thresholdP.appendChild(thresholdStrong);
            thresholdP.appendChild(document.createTextNode(item.thresholdText));

            // Reporting Entity (p)
            const entityP = document.createElement('p');
            entityP.className = 'text-sm';
            entityP.style.color = 'var(--text-secondary)';

            const entityStrong = document.createElement('strong');
            entityStrong.style.color = 'var(--text-primary)';
            entityStrong.textContent = 'Reporting Entity: ';
            entityP.appendChild(entityStrong);
            entityP.appendChild(document.createTextNode(item.entity));

            // View Details Button
            const detailsButton = document.createElement('button');
            detailsButton.className = 'text-xs mt-2'; // Tailwind classes
            detailsButton.style.color = 'var(--link-blue)';
            detailsButton.style.textDecoration = 'underline';
            detailsButton.textContent = 'View Details';
            detailsButton.onclick = function() { showTransactionDetails(item.sl - 1); }; // Corrected to use item.sl

            card.appendChild(titleH4);
            card.appendChild(thresholdP);
            card.appendChild(entityP);
            card.appendChild(detailsButton);

            transactionListDiv.appendChild(card);
        });
    }
    // --- END CORRECTED displayTransactions function ---
    
    window.showTransactionDetails = function(index) {
        const item = sftData[index];
        const existingModal = document.getElementById('sftDetailModal');
        if (existingModal) {
            existingModal.remove();
        }

        const modalHTML = `
            <div id="sftDetailModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.55); display: flex; justify-content: center; align-items: center; z-index: 1050; padding: 15px; box-sizing: border-box;">
                <div style="background-color: var(--background-light); padding: 25px 30px; border-radius: 14px; max-width: 550px; width: 100%; box-shadow: 0 10px 30px rgba(0,0,0,0.15); font-family: var(--font-family-apple); text-align: left;">
                    <h3 style="font-size: 1.2rem; font-weight: 600; color: var(--text-primary); margin-bottom: 1rem; margin-top:0;">SFT Detail (Sl. No. ${item.sl})</h3>
                    <p style="margin-bottom: 0.75rem; font-size: 0.95rem; color: var(--text-secondary);"><strong style="color: var(--text-primary);">Nature:</strong> ${item.nature}</p>
                    <p style="margin-bottom: 0.75rem; font-size: 0.95rem; color: var(--text-secondary);"><strong style="color: var(--text-primary);">Threshold:</strong> ${item.thresholdText}</p>
                    <p style="margin-bottom: 1.5rem; font-size: 0.95rem; color: var(--text-secondary);"><strong style="color: var(--text-primary);">Reporting Entity:</strong> ${item.entity}</p>
                    <button onclick="document.getElementById('sftDetailModal').remove()" style="background-color: var(--link-blue); color: white; padding: 0.6rem 1.2rem; border-radius: 8px; border: none; cursor: pointer; font-size: 0.9rem; font-weight:500;">Close</button>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }


    function filterTransactions() {
        const keyword = filterKeywordInput.value.toLowerCase();
        const threshold = parseInt(filterThresholdSelect.value) || 0;
        const entity = filterEntitySelect.value.toLowerCase();

        const filtered = sftData.filter(item => {
            const natureMatch = item.nature.toLowerCase().includes(keyword);
            const entityMatch = entity === "" || item.entity.toLowerCase().split(',').map(e=>e.trim()).some(e => e.includes(entity));
            
            let thresholdMatch = true;
            if (threshold > 0) {
                if (Array.isArray(item.thresholdVal)) {
                     thresholdMatch = item.thresholdVal.some(tv => threshold <= tv);
                } else {
                    thresholdMatch = threshold <= item.thresholdVal;
                }
            }
            return natureMatch && entityMatch && thresholdMatch;
        });
        displayTransactions(filtered);
    }

    function updateThresholdChart() {
        const thresholdCounts = {};
        sftData.forEach(item => {
            const key = Array.isArray(item.thresholdVal) ? item.thresholdVal.map(tv => `‚Çπ${tv}L`).join('/') + ' (Multiple)' : `‚Çπ${item.thresholdVal} Lakhs`;
            thresholdCounts[key] = (thresholdCounts[key] || 0) + 1;
        });

        const labels = Object.keys(thresholdCounts).sort((a,b) => {
            const valA = parseFloat(a.replace('‚Çπ','').split(' ')[0]);
            const valB = parseFloat(b.replace('‚Çπ','').split(' ')[0]);
            return valA - valB;
        });
        const data = labels.map(label => thresholdCounts[label]);

        const ctx = document.getElementById('thresholdChart').getContext('2d');
        if (thresholdChartInstance) {
            thresholdChartInstance.destroy();
        }
        thresholdChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'No. of SFT Categories',
                    data: data,
                    backgroundColor: 'rgba(var(--link-blue-rgb), 0.7)',
                    borderColor: 'var(--link-blue)',
                    borderWidth: 1,
                    borderRadius: 4,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1, color: 'var(--text-secondary)' },
                        grid: { color: 'var(--border-color-light)' }
                    },
                    x: {
                        ticks: { color: 'var(--text-secondary)',
                             callback: function(value, index, values) {
                                const label = this.getLabelForValue(value);
                                return label.length > 18 ? label.substring(0,18) + '...' : label;
                            }
                        },
                        grid: { display: false }
                    }
                },
                plugins: {
                    legend: { labels: { color: 'var(--text-primary)' } },
                    tooltip: {
                        backgroundColor: 'rgba(29, 29, 31, 0.85)',
                        titleColor: '#f5f5f7', bodyColor: '#f5f5f7',
                        callbacks: {
                            title: function(tooltipItems) { return tooltipItems[0].label; }
                        }
                    }
                }
            }
        });
    }


    function handleNavigation() {
        const hash = window.location.hash || '#overview';
        navLinks.forEach(link => {
            link.classList.toggle('active', link.getAttribute('href') === hash);
        });
        contentSections.forEach(section => {
            section.classList.toggle('active', ('#' + section.id) === hash);
        });
        if (event && event.type === 'hashchange') { 
            const targetElement = document.querySelector(hash);
            if(targetElement) {
                 const headerTotalHeight = document.getElementById('mainNav').offsetHeight + 
                                         (document.querySelector('.page-title-header') ? document.querySelector('.page-title-header').offsetHeight : 0);
                 const elementPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
                 const offsetPosition = elementPosition - headerTotalHeight;
                 window.scrollTo({top: offsetPosition, behavior: 'smooth'});
            }
        } else if (window.location.hash === '') { 
             window.scrollTo(0,0);
        }
    }
    
    document.querySelectorAll('.accordion-header').forEach(header => {
        header.addEventListener('click', () => {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('.arrow-icon');
            header.classList.toggle('open'); 
            if (content.style.maxHeight && content.style.maxHeight !== '0px') {
                content.style.maxHeight = '0px';
            } else {
                content.style.maxHeight = content.scrollHeight + 'px';
            }
        });
    });


    window.addEventListener('hashchange', handleNavigation);
    window.addEventListener('load', () => {
        handleNavigation(); 
        populateEntityFilter();
        displayTransactions(sftData);
        updateThresholdChart();
        if(filterKeywordInput) filterKeywordInput.addEventListener('input', filterTransactions);
        if(filterThresholdSelect) filterThresholdSelect.addEventListener('change', filterTransactions);
        if(filterEntitySelect) filterEntitySelect.addEventListener('change', filterTransactions);
    });

</script>
</body>
</html>
